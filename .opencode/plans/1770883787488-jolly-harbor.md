# Plan: Update `client/core/*` Docs for Strict Separation (No Colocation)

## Goal
Update the frontend core docs under `client/core/` to match the clarified team convention:

- React Query (TanStack Query) hooks must live in `src/features/<feature>/hooks.ts` (never inline in TSX).
- Local, component-specific `useEffect` is allowed to stay colocated in the component.
- Shared feature types live in `src/features/<feature>/types.ts` (component prop types can stay local).
- DTOs must live in dedicated file(s) (never defined inside `hooks.ts` or TSX).
- Helpers/domain logic must live in dedicated file(s) (never inline in TSX beyond trivial glue).

Also integrate the provided **State Management Decision Guide (Junior Reference)** into `client/core` as an at-a-glance rule set.

## Key Conflicts Found

- `client/core/composition.md` currently recommends query colocation in business components and includes TSX examples calling `trpc.*.useQuery()` inline.
- `client/core/conventions.md` explicitly presents “component-first vs hook-first” as a choice; we need a single convention: server-state hooks in `features/<feature>/hooks.ts`.
- `client/core/folder-structure.md` lacks `types.ts` / DTO file(s) / domain file(s) in feature layout and recommends shared client hooks living in `index.ts`.

## Deliverables

### 1) Rewrite `client/core/composition.md`

- Remove “React Query colocation” framing.
- Keep the mantra, but redefine “fetch low” as: “fetch in feature business layer through `features/<feature>/hooks.ts`, not providers and not inline TSX.”
- Add an explicit “File Separation Rules” section covering:
  - hooks.ts (ALL queries/mutations)
  - types.ts (shared feature types)
  - DTO file(s)
  - domain.ts / helpers.ts
  - colocated `useEffect` allowed
- Update examples to import feature hooks instead of calling `trpc.*.useQuery()` in TSX.

### 2) Add Junior Decision Guide to `client/core/state-management.md`

- Insert a new top section: `## State Management Decision Guide (Junior Reference)`.
- Normalize wording to this repo:
  - TanStack Query (React Query) as the default for async/IO state
  - Share async data via cache/queryKey; avoid big data providers
  - Context/Zustand for client coordination only
  - useState for local ephemeral UI state
- Replace any “colocate queries in components” phrasing with “put queries in feature hooks.ts; components call feature hooks”.
- Add a pointer to the parent doc: `client/core/composition.md`.

### 3) Update `client/core/conventions.md`

- Feature components (business layer): remove inline query examples; show calling feature hooks.
- Feature hooks: make TanStack Query/tRPC query+mutation hooks mandatory here (no “component-first” option).
- Helpers: remove “DTO definitions/mapping” from helpers; introduce/point to dedicated DTO file(s) and domain logic file(s).
- Naming conventions + checklist: add `types.ts`, DTO file naming, `domain.ts`.

### 4) Update `client/core/folder-structure.md`

- Expand feature module structure to include:
  - `types.ts`
  - DTO file(s)
  - `domain.ts`
  - clarify `hooks.ts` is for ALL server-state hooks + reusable feature hooks
- Update “Shared API Clients (Non-tRPC)” layout so React Query hooks are in a `hooks.ts` file (not `index.ts`).
- Update naming tables and decision guide/checklist accordingly.

### 5) Align `client/core/data-fetching.md` + `client/core/overview.md`

- Add a small convention note: “In features, create query/mutation hooks in `features/<feature>/hooks.ts` and consume them from components.”
- Update any examples/phrasing that imply inline queries in TSX are the default.

## Files To Change (all under `client/core/`)

- Update: `client/core/composition.md`
- Update: `client/core/state-management.md`
- Update: `client/core/conventions.md`
- Update: `client/core/folder-structure.md`
- Update: `client/core/data-fetching.md`
- Update: `client/core/overview.md`

## Proposed Feature Module Tree (ASCII)

```text
src/features/<feature>/
├── components/
│   ├── <feature>-form.tsx
│   ├── <feature>-form-fields.tsx
│   ├── <feature>-list.tsx
│   └── <feature>-card.tsx
├── stores/                       # optional (Zustand)
│   └── <name>-store.ts
├── hooks.ts                      # ALL React Query hooks + reusable feature hooks
├── schemas.ts                    # UI form schemas
├── types.ts                      # shared feature types (non-DTO)
├── dtos.ts                       # DTOs + mapping (dedicated)
├── domain.ts                     # business rules (dedicated)
└── helpers.ts                    # small pure utilities
```

## Verification

- Grep checks:
  - `rg -n "colocat" client/core/composition.md` should not recommend inline queries in TSX.
  - `rg -n "Data fetching location is a project choice" client/core/conventions.md` should be removed.
- Read-through consistency: `composition.md`, `conventions.md`, `folder-structure.md`, `state-management.md`, `data-fetching.md`, `overview.md` all agree on “React Query hooks live in feature hooks.ts”.
